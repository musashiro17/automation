<!DOCTYPE html>
<html>
<body>
<h2>Stage 2 Review & Approval</h2>
<form id="stage2Form">
  <label for="proposedAlias">Proposed Alias:</label><br>
  <input type="text" id="proposedAlias" name="proposedAlias" required><br><br>

  <label for="managerEmail">Manager Email:</label><br>
  <input type="email" id="managerEmail" name="managerEmail" required><br><br>

  <label for="department">Department:</label><br>
  <input type="text" id="department" name="department" required><br><br>

  <label for="location">Location:</label><br>
  <input type="text" id="location" name="location" required><br><br>

  <!-- Hidden fields -->
  <input type="hidden" id="csrf" name="csrf">
  <input type="hidden" id="upn" name="upn">
  <input type="hidden" id="samAccountName" name="samAccountName">
  <input type="hidden" id="ouDn" name="ouDn">
  <input type="hidden" id="baseGroups" name="baseGroups">
  <input type="hidden" id="licenses" name="licenses">

  <input type="submit" value="Submit Stage 2">
</form>

<script>
// Stage 2 prefill from URL query parameters
function prefillForm() {
  const params = new URLSearchParams(window.location.search);
  
  document.getElementById("proposedAlias").value = params.get("proposedAlias") || "";
  document.getElementById("managerEmail").value = params.get("managerEmail") || "";
  document.getElementById("department").value = params.get("department") || "";
  document.getElementById("location").value = params.get("location") || "";
  document.getElementById("csrf").value = params.get("csrf") || "";
  document.getElementById("upn").value = params.get("upn") || "";
  document.getElementById("samAccountName").value = params.get("samAccountName") || "";
  document.getElementById("ouDn").value = params.get("ouDn") || "";
  document.getElementById("baseGroups").value = params.get("baseGroups") || "";
  document.getElementById("licenses").value = params.get("licenses") || "";
}

prefillForm();

document.getElementById("stage2Form").addEventListener("submit", function(e){
  e.preventDefault();
  
  const payload = {
    proposedAlias: document.getElementById("proposedAlias").value,
    managerEmail: document.getElementById("managerEmail").value,
    department: document.getElementById("department").value,
    location: document.getElementById("location").value,
    csrf: document.getElementById("csrf").value,
    upn: document.getElementById("upn").value,
    samAccountName: document.getElementById("samAccountName").value,
    ouDn: document.getElementById("ouDn").value,
    baseGroups: document.getElementById("baseGroups").value,
    licenses: document.getElementById("licenses").value
  };
  
  console.log("Stage 2 Payload:", payload);

  fetch("https://musashiro17.app.n8n.cloud/webhook-test/provision/stage2", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(payload)
  })
  .then(resp => resp.json())
  .then(data => alert("Stage 2 submitted successfully!"))
  .catch(err => alert("Error submitting Stage 2"));
});
</script>
</body>
</html>
