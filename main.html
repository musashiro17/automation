<!DOCTYPE html>
<html>
<body>
<h2>Stage 1 User Submission</h2>
<form id="stage1Form">
  <label for="proposedAlias">Proposed Alias:</label><br>
  <input type="text" id="proposedAlias" name="proposedAlias" required><br><br>

  <label for="managerEmail">Manager Email:</label><br>
  <input type="email" id="managerEmail" name="managerEmail" required><br><br>

  <label for="department">Department:</label><br>
  <input type="text" id="department" name="department" required><br><br>

  <label for="location">Location:</label><br>
  <input type="text" id="location" name="location" required><br><br>

  <input type="submit" value="Submit">
</form>

<script>
document.getElementById("stage1Form").addEventListener("submit", function(e) {
  e.preventDefault();

  function generateCSRF(length = 20) {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let token = '';
    for (let i = 0; i < length; i++) token += chars.charAt(Math.floor(Math.random() * chars.length));
    return token;
  }

  const payload = {
    csrf: generateCSRF(),
    hp: "",
    proposedAlias: document.getElementById("proposedAlias").value,
    managerEmail: document.getElementById("managerEmail").value,
    department: document.getElementById("department").value,
    location: document.getElementById("location").value
  };

  console.log("Stage 1 Payload:", payload);

  // Send Stage 1 payload asynchronously
  fetch("https://musashiro17.app.n8n.cloud/webhook/provision/stage1", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  }).catch(err => console.error("Stage 1 webhook error:", err));

  // Redirect immediately to Stage 2 with prefill
  const encoded = encodeURIComponent(JSON.stringify(payload));
  window.location.href = `stage2.html?data=${encoded}`;
});
</script>
</body>
</html>



